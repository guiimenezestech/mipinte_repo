<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MiPinte — Loja</title>
  <style>
    :root{
      --bg:#F9FAFB; --card:#FFFFFF; --text:#0F172A; --muted:#64748B;
      --primary:#4D96FF; --border:#E2E8F0; --shadow:0 6px 24px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif}
    .wrap{max-width:1060px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .title{font-size:24px;font-weight:800}
    .subtitle{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:16px}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden;
      box-shadow:var(--shadow); display:flex; flex-direction:column;
    }
    .thumb{
      width:100%; aspect-ratio:1/1; object-fit:cover; background:#fff; border-bottom:1px solid var(--border);
    }
    .body{padding:12px; display:flex; flex-direction:column; gap:6px}
    .name{font-weight:800; font-size:16px; line-height:1.15}
    .row{display:flex; align-items:center; justify-content:space-between}
    .badge{font-size:12px; color:var(--muted)}
    .btn{
      appearance:none; border:none; border-radius:999px; padding:10px 14px; font-weight:800; cursor:pointer;
      text-decoration:none; display:inline-flex; align-items:center; justify-content:center; gap:8px;
      background:var(--primary); color:#fff;
    }
    .btn:active{transform:translateY(1px)}
    .ghost{background:#fff; color:var(--muted); border:1px solid var(--border)}
    .topnote{
      background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px 12px; color:var(--muted);
      font-size:12px;
    }
    .status{margin-top:12px}
    .error{background:#fff3f3;border:1px solid #ffd6d6;color:#7a1f1f;padding:12px;border-radius:12px}
    .empty{color:var(--muted); text-align:center; padding:24px}
    .skeleton{
      background:linear-gradient(90deg,#f2f4f7 25%,#e9edf2 37%,#f2f4f7 63%);
      background-size:400% 100%; animation:shimmer 1.2s infinite; border-radius:12px; height:180px; border:1px solid var(--border);
    }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">MiPinte — Loja</div>
        <div class="subtitle">Toque em “Instalar no MiPinte” no celular para adicionar novos desenhos.</div>
      </div>
      <div class="topnote">O app deriva o <b>id</b> do nome do arquivo antes de <code>.zip</code>.</div>
    </header>

    <div id="status" class="status"></div>

    <!-- grid de cards -->
    <div id="grid" class="grid" aria-live="polite">
      <!-- skeleton loading -->
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
    </div>

    <div id="empty" class="empty" style="display:none">Nenhum item encontrado no catálogo.</div>
  </div>

  <script>
    const CATALOG_URL = './catalog.json'; // lê do mesmo repo (GitHub Pages)

    const $ = (q)=>document.querySelector(q);
    const grid = $('#grid'), statusBox = $('#status'), emptyBox = $('#empty');

    function deepLink(zip){ return 'mipinte://install?url=' + encodeURIComponent(zip); }
    function status(msg, isErr=false){
      if(!msg){ statusBox.innerHTML=''; return; }
      statusBox.innerHTML = `<div class="${isErr?'error':'topnote'}">${escapeHtml(msg)}</div>`;
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    async function loadCatalog(){
      try{
        status('Carregando catálogo…');
        const res = await fetch(CATALOG_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('Falhou ao carregar catálogo ('+res.status+')');
        const list = await res.json();
        if(!Array.isArray(list)) throw new Error('Catálogo inválido: esperado array');

        // ordena por título
        list.sort((a,b)=> (a.title||'').localeCompare(b.title||''));
        render(list);
        status('');
      }catch(e){
        render([]);
        status(e.message || 'Erro ao carregar catálogo.', true);
      }
    }

    function render(items){
      grid.innerHTML = '';
      if(!items.length){ emptyBox.style.display='block'; return; }
      emptyBox.style.display='none';

      for(const it of items){
        const title = it.title || '(sem título)';
        const zip   = it.zip;
        const ver   = it.version ? 'v'+it.version : '';
        const thumb = it.thumb || '';

        const card = document.createElement('div');
        card.className = 'card';

        const img = document.createElement('img');
        img.className = 'thumb';
        if(thumb) img.src = thumb;
        img.alt = title;
        img.onerror = ()=>{ img.style.display='none'; };

        const body = document.createElement('div');
        body.className = 'body';

        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = title;

        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `<span class="badge">${escapeHtml(ver)}</span>`;

        const actions = document.createElement('div');
        actions.className = 'row';
        const install = document.createElement('a');
        install.className = 'btn';
        install.textContent = 'Instalar no MiPinte';
        install.href = deepLink(zip);

        const zipLink = document.createElement('a');
        zipLink.className = 'btn ghost';
        zipLink.textContent = 'Baixar .zip';
        zipLink.href = zip;

        actions.appendChild(install);
        actions.appendChild(zipLink);

        body.appendChild(name);
        body.appendChild(row);
        body.appendChild(actions);

        card.appendChild(img);
        card.appendChild(body);
        grid.appendChild(card);
      }
    }

    loadCatalog();
  </script>
</body>
</html>
